# 厦门大学小学期课程《电子设计与工艺实训》中基于鸿蒙hi3861的双路红外循迹超声波避障小车

## 硬件
- hi3861系统板
- oled显示板
- 电机驱动板（L9110S）
- 底板
- TCRT5000红外传感器模块（两个）
- HCSR04超声波传感器模块
- SG90舵机（未使用）
- TT电机（两个）
- 电池和电池盒

## 软件
### 代码目录
```
.../app/06_0703_Line/
├── BUILD.gn
├── libm_port/
│   ├── BUILD.gn
│   ├── __cos.c
│   ├── __sin.c
│   ├── __rem_pio2_large.c
│   ├── __rem_pio2.c
│   ├── cos.c
│   ├── sin.c
│   ├── features.h
│   └── libm.h
├── ssd1306/
│   ├── BUILD.gn
│   ├── ssd1306_conf.h
│   ├── ssd1306_fonts.c
│   ├── ssd1306_fonts.h
│   ├── ssd1306.c
│   └── ssd1306.h
├── robot_line/
│   ├── BUILD.gn
│   └── robot_line_test.c
├── README.md
└── LICENSE
```

### 代码逻辑
主要分为以下几个函数
1. **路口巡线**：当两个传感器都检测到黑线时，认为到达十字路口，结束巡线
2. **定时巡线**：当经过设定时间后，结束巡线
3. **启动马达**：为马达设置速度并延时等待

---
根据实际赛道，可将地图用路口分为若干段，当行进路线需要经过两次路口时，可以按**路口巡线-启动马达-路口巡线-启动马达-路口巡线**的顺序调用函数，其中启动马达用于冲过路口，防止路口黑线影响下一段巡线；而过锐角弯的部分可以用**定时巡线**设定特殊参数使小车每一次过弯时都以*左/右*传感器压线的姿态入弯，以此可以达到稳定过弯的效果。

---
巡线逻辑：调用函数后进入*巡线循环*，当左传感器压线时，左轮后退，右轮前进；当右传感器压线时，右轮后退，左轮前进；当同时压线时，停止电机；当都未压线时，直行前进；*巡线循环*停止条件见上。

---
避障逻辑：避障包含于*巡线循环*内，当测得障碍物距离过近时进入*超声波循环*，不断测量新距离直到距离大于设定值后，跳出*超声波循环*回到*巡线循环*内。

---
其他逻辑请自行查看具体代码，不再赘述

### 软件使用流程
**选择赛道->设定速度偏移量->按键启动->等待巡线完成**
